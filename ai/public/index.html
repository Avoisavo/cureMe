<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Models Test - CureMe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .content {
      padding: 40px;
    }

    .form-group {
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      resize: vertical;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .model-select {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .model-select {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .model-option {
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      background: white;
      font-size: 15px;
    }

    .model-option:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .model-option input[type="radio"] {
      display: none;
    }

    .model-option.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    .model-option label {
      margin: 0;
      cursor: pointer;
      font-weight: 600;
    }

    button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .response {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      display: none;
    }

    .response.show {
      display: block;
    }

    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .response-header h3 {
      color: #333;
      font-size: 20px;
    }

    .response-meta {
      font-size: 12px;
      color: #666;
    }

    .response-content {
      color: #333;
      line-height: 1.8;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 15px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #667eea;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      background: #fee;
      border-left-color: #f44336;
      color: #c62828;
    }

    @media (max-width: 768px) {
      #comparisonView > div {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ü§ñ AI Models Test</h1>
      <p>Test OpenAI, DeepSeek, and Qwen models</p>
    </div>

    <div class="content">
      <form id="chatForm">
        <div class="form-group">
          <label>Select Model:</label>
          <div class="model-select">
            <div class="model-option active">
              <input type="radio" name="model" value="all" id="all" checked>
              <label for="all">ü§ù All Models (Discussion)</label>
            </div>
            <div class="model-option">
              <input type="radio" name="model" value="openai" id="openai">
              <label for="openai">OpenAI GPT-4</label>
            </div>
            <div class="model-option">
              <input type="radio" name="model" value="llama-8b" id="llama-8b">
              <label for="llama-8b">DeepSeek</label>
            </div>
            <div class="model-option">
              <input type="radio" name="model" value="llama-70b" id="llama-70b">
              <label for="llama-70b">Llama 70B</label>
            </div>
            <div class="model-option">
              <input type="radio" name="model" value="qwen" id="qwen">
              <label for="qwen">Qwen 32B</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="prompt">Enter your prompt:</label>
          <textarea 
            id="prompt" 
            name="prompt" 
            placeholder="Type your message here..."
            required
          ></textarea>
        </div>

        <button type="submit" id="submitBtn">Send Message</button>
      </form>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p id="loadingText">Thinking...</p>
      </div>

      <div class="response" id="response">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0;">Answers</h3>
          <span class="response-meta" id="meta"></span>
        </div>
        
        <!-- Side-by-side comparison (only shown for "all" model) -->
        <div id="comparisonView" style="display: none;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <!-- Final Answer -->
            <div style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 30px; background: #fafafa; min-height: 200px;">
              <div class="response-header" style="margin-bottom: 20px;">
                <h3 style="margin: 0; color: #333; font-size: 22px;">Final Answer</h3>
              </div>
              <div class="response-content" id="responseContent" style="line-height: 1.8; font-size: 15px;"></div>
            </div>
            
            <!-- Humanized Answer -->
            <div style="border: 2px solid #667eea; border-radius: 12px; padding: 30px; background: #f8f9ff; min-height: 200px;">
              <div class="response-header" style="margin-bottom: 20px;">
                <h3 style="margin: 0; color: #667eea; font-size: 22px;">‚ù§Ô∏è Humanized Answer</h3>
              </div>
              <div class="response-content" id="humanizedContent" style="color: #555; line-height: 1.8; font-size: 15px;"></div>
            </div>
          </div>
        </div>
        
        <!-- Single answer view (for individual models) -->
        <div id="singleView">
          <div class="response-content" id="singleResponseContent" style="font-size: 15px; line-height: 1.8; padding: 20px 0;"></div>
        </div>
        
        <!-- Initial responses (only shown for "all" model) -->
        <div id="initialResponses" style="display: none; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
          <h4 style="margin-bottom: 15px; color: #667eea;">Initial Responses from Each Model:</h4>
          <div id="initialResponsesContent"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('chatForm');
    const promptInput = document.getElementById('prompt');
    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    const response = document.getElementById('response');
    const responseContent = document.getElementById('responseContent');
    const singleResponseContent = document.getElementById('singleResponseContent');
    const meta = document.getElementById('meta');
    const initialResponses = document.getElementById('initialResponses');
    const initialResponsesContent = document.getElementById('initialResponsesContent');
    const comparisonView = document.getElementById('comparisonView');
    const singleView = document.getElementById('singleView');
    const humanizedContent = document.getElementById('humanizedContent');
    const loadingText = document.getElementById('loadingText');
    const modelOptions = document.querySelectorAll('.model-option');

    // Model selection handler
    modelOptions.forEach(option => {
      option.addEventListener('click', () => {
        modelOptions.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');
        const radio = option.querySelector('input[type="radio"]');
        if (radio) radio.checked = true;
      });
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const prompt = promptInput.value.trim();
      if (!prompt) return;

      const selectedModel = document.querySelector('input[name="model"]:checked').value;

      // Show loading, hide response
      loading.classList.add('show');
      response.classList.remove('show');
      submitBtn.disabled = true;
      
      // Update loading message based on model
      if (selectedModel === 'all') {
        loadingText.textContent = 'ü§ñ All models discussing... This may take a moment';
      } else {
        loadingText.textContent = 'Thinking...';
      }

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            prompt,
            model: selectedModel,
          }),
        });

        const data = await res.json();

        loading.classList.remove('show');

        if (data.success) {
          meta.textContent = `${data.duration}ms`;
          response.classList.remove('error');
          response.classList.add('show');
          
          // Show side-by-side comparison for "all" model, single view for others
          if (data.humanizedResponse && selectedModel === 'all') {
            // Show comparison view (side-by-side)
            comparisonView.style.display = 'block';
            singleView.style.display = 'none';
            
            // Final Answer
            responseContent.textContent = data.response || 'No response';
            
            // Format humanized answer as paragraphs
            const text = data.humanizedResponse;
            // Split by double newlines to create paragraphs, or single newlines if no double newlines exist
            const paragraphs = text.includes('\n\n') 
              ? text.split(/\n\n+/).filter(p => p.trim())
              : text.split(/\n/).filter(p => p.trim());
            
            let html = '';
            paragraphs.forEach(paragraph => {
              html += `<p style="margin-bottom: 1em; color: #555; line-height: 1.8;">${paragraph.trim()}</p>`;
            });
            humanizedContent.innerHTML = html;
          } else {
            // Show single view for individual models
            comparisonView.style.display = 'none';
            singleView.style.display = 'block';
            singleResponseContent.textContent = data.response || 'No response';
          }
          
          // Show initial responses if available (for "all" model discussion)
          if (data.initialResponses && selectedModel === 'all') {
            let html = '';
            for (const [modelName, modelResponse] of Object.entries(data.initialResponses)) {
              html += `<div style="margin-bottom: 15px; padding: 12px; background: #f8f9fa; border-radius: 6px;">
                <strong style="color: #667eea;">${modelName}:</strong>
                <p style="margin: 8px 0 0 0; color: #555;">${modelResponse}</p>
              </div>`;
            }
            initialResponsesContent.innerHTML = html;
            initialResponses.style.display = 'block';
          } else {
            initialResponses.style.display = 'none';
          }
        } else {
          comparisonView.style.display = 'none';
          singleView.style.display = 'block';
          singleResponseContent.textContent = `Error: ${data.error}`;
          meta.textContent = '';
          response.classList.add('error');
          response.classList.add('show');
        }
      } catch (error) {
        loading.classList.remove('show');
        comparisonView.style.display = 'none';
        singleView.style.display = 'block';
        singleResponseContent.textContent = `Error: ${error.message}`;
        meta.textContent = '';
        response.classList.add('error');
        response.classList.add('show');
        initialResponses.style.display = 'none';
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>

